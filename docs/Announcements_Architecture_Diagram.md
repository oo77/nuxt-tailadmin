# Архитектура системы объявлений (визуальная схема)

## Общая структура данных

```
┌─────────────────────────────────────────────────────────────────┐
│                         ANNOUNCEMENTS                            │
│  (Объявления о наборе на обучение)                              │
│                                                                  │
│  • Название, описание                                           │
│  • Статус (draft/published/closed/archived)                     │
│  • Настройки приёма заявок                                      │
│  • Сроки подачи заявок                                          │
└────────────────────┬────────────────────────────────────────────┘
                     │
                     │ 1:N
                     ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ANNOUNCEMENT_GROUPS                           │
│  (Учебные группы в объявлении)                                  │
│                                                                  │
│  • Связь с объявлением                                          │
│  • Связь с учебной группой                                      │
│  • Макс. количество мест                                        │
│  • Текущее бронирование                                         │
└────────────────────┬────────────────────────────────────────────┘
                     │
                     │ N:1
                     ▼
┌─────────────────────────────────────────────────────────────────┐
│                      STUDY_GROUPS                                │
│  (Учебные группы - без логики заявок)                          │
│                                                                  │
│  • Код группы                                                   │
│  • Курс обучения                                                │
│  • Даты обучения                                                │
│  • Слушатели                                                    │
└─────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────┐
│                   ANNOUNCEMENT_REQUESTS                          │
│  (Заявки от представителей организаций)                        │
│                                                                  │
│  • Связь с объявлением                                          │
│  • Организация и представитель                                  │
│  • Статус (draft/pending/approved/rejected)                     │
│  • Тип (со списком / бронирование)                             │
│  • PDF-документ заявки                                          │
└────────────────────┬────────────────────────────────────────────┘
                     │
                     │ 1:N
                     ▼
┌─────────────────────────────────────────────────────────────────┐
│               ANNOUNCEMENT_REQUEST_GROUPS                        │
│  (Группы, выбранные в заявке)                                   │
│                                                                  │
│  • Связь с заявкой                                              │
│  • Связь с announcement_group                                   │
│  • Запрошенное количество мест                                  │
│  • Статус для группы                                            │
└────────────────────┬────────────────────────────────────────────┘
                     │
                     │ 1:N (опционально)
                     ▼
┌─────────────────────────────────────────────────────────────────┐
│            ANNOUNCEMENT_REQUEST_EMPLOYEES                        │
│  (Конкретные сотрудники в заявке)                              │
│                                                                  │
│  • Связь с request_group                                        │
│  • Связь со студентом                                           │
│  • Статус (proposed/confirmed/enrolled)                         │
└─────────────────────────────────────────────────────────────────┘
```

---

## Workflow: Создание и обработка объявления

```
АДМИНИСТРАТОР                    СИСТЕМА                    ПРЕДСТАВИТЕЛЬ

1. Создание объявления
   │
   ├─→ Выбор групп ────────────→ announcement_groups
   │                                    │
   ├─→ Настройки ──────────────→ announcements
   │                                    │
   └─→ Публикация ─────────────→ status = 'published'
                                        │
                                        │
                                        ▼
                              Объявление доступно ←──────┐
                                        │                 │
                                        │                 │
2. Подача заявки                       │                 │
                                        │                 │
                                        ├─────────────────┤
                                        │                 │
                                        │           Просмотр объявлений
                                        │                 │
                                        │           Выбор объявления
                                        │                 │
                                        │           Формирование заявки:
                                        │           • Выбор групп
                                        │           • Выбор сотрудников
                                        │             или указание кол-ва
                                        │           • Загрузка PDF
                                        │                 │
                                        ▼                 │
                              announcement_requests ◄─────┘
                                        │
                                        │ status = 'pending'
                                        │
                                        ▼
3. Рассмотрение заявки          Уведомление админу
   │                                    │
   ├─→ Просмотр деталей ───────────────┤
   │   • Организация                    │
   │   • Группы и кол-во мест          │
   │   • Список сотрудников            │
   │   • PDF-документ                   │
   │                                    │
   ├─→ Проверка мест ──────────→ Проверка capacity
   │                                    │
   └─→ Одобрение/Отклонение            │
       │                                │
       ├─→ Одобрено ───────────→ status = 'approved'
       │                         Резервирование мест
       │                         Уведомление представителю
       │
       └─→ Отклонено ──────────→ status = 'rejected'
                                 Причина отклонения
                                 Уведомление представителю
```

---

## Типы заявок

### Вариант А: Заявка со списком сотрудников

```
ПРЕДСТАВИТЕЛЬ
     │
     ├─→ Выбирает объявление
     │
     ├─→ Для каждой группы:
     │   ├─→ Выбирает сотрудников из своей организации
     │   │   (используя EmployeeMultiSelect)
     │   └─→ Количество = кол-во выбранных
     │
     ├─→ Загружает PDF заявки
     │
     └─→ Отправляет заявку
         │
         ▼
     announcement_requests
         ├─→ request_type = 'with_employees'
         ├─→ total_requested_slots = сумма по группам
         │
         └─→ announcement_request_groups
             └─→ announcement_request_employees
                 (конкретные сотрудники)
```

### Вариант Б: Заявка с бронированием мест

```
ПРЕДСТАВИТЕЛЬ
     │
     ├─→ Выбирает объявление
     │
     ├─→ Для каждой группы:
     │   └─→ Указывает количество мест
     │
     ├─→ Загружает PDF заявки
     │
     └─→ Отправляет заявку
         │
         ▼
     announcement_requests
         ├─→ request_type = 'reservation'
         ├─→ total_requested_slots = сумма по группам
         │
         └─→ announcement_request_groups
             └─→ requested_slots (без конкретных сотрудников)

     Позже:
         └─→ Представитель или админ добавляет сотрудников
             └─→ announcement_request_employees
```

---

## Интерфейсы пользователей

### Администратор

```
┌─────────────────────────────────────────────────────────────┐
│  ГЛАВНОЕ МЕНЮ                                               │
│                                                             │
│  • Дашборд                                                  │
│  • Учебные группы ────────→ Управление группами            │
│  • Объявления ────────────→ Управление объявлениями        │
│    ├─→ Список объявлений                                   │
│    ├─→ Создать объявление                                  │
│    └─→ Заявки (все)                                        │
│  • Студенты                                                 │
│  • Организации                                              │
│  • ...                                                      │
└─────────────────────────────────────────────────────────────┘

Страница объявления:
┌─────────────────────────────────────────────────────────────┐
│  Объявление: "Набор на курс ПДД 2026"                      │
│  Статус: Опубликовано                                       │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Группы в объявлении:                                │   │
│  │ • Группа ПДД-01 (20/30 мест)                       │   │
│  │ • Группа ПДД-02 (15/30 мест)                       │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Заявки (12):                                        │   │
│  │                                                      │   │
│  │ [Ожидают] ООО "Компания А" - 5 мест                │   │
│  │ [Одобрено] ООО "Компания Б" - 8 мест               │   │
│  │ [Отклонено] ООО "Компания В" - 3 места             │   │
│  │ ...                                                  │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### Представитель организации

```
┌─────────────────────────────────────────────────────────────┐
│  МЕНЮ ПРЕДСТАВИТЕЛЯ                                         │
│                                                             │
│  • Доступные объявления ──→ Просмотр и подача заявок       │
│  • Мои заявки ────────────→ Статус заявок                  │
│  • Мои сотрудники ────────→ Список студентов организации   │
└─────────────────────────────────────────────────────────────┘

Страница объявлений:
┌─────────────────────────────────────────────────────────────┐
│  Доступные объявления о наборе                              │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📢 Набор на курс ПДД 2026                          │   │
│  │    Группы: ПДД-01, ПДД-02                          │   │
│  │    Доступно: 35 мест                                │   │
│  │    Срок подачи: до 20.02.2026                      │   │
│  │    [Подать заявку]                                  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📢 Обучение по охране труда                        │   │
│  │    Группы: ОТ-15                                    │   │
│  │    Доступно: 12 мест                                │   │
│  │    Срок подачи: до 25.02.2026                      │   │
│  │    [Подать заявку]                                  │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘

Форма подачи заявки:
┌─────────────────────────────────────────────────────────────┐
│  Подача заявки: "Набор на курс ПДД 2026"                   │
│                                                             │
│  Выберите группы и сотрудников:                            │
│                                                             │
│  ☑ Группа ПДД-01 (доступно 10 мест)                       │
│    └─→ [Выбрать сотрудников] (выбрано: 3)                 │
│                                                             │
│  ☑ Группа ПДД-02 (доступно 15 мест)                       │
│    └─→ [Выбрать сотрудников] (выбрано: 2)                 │
│                                                             │
│  Загрузите PDF заявки: [Выбрать файл] ✓ заявка.pdf        │
│                                                             │
│  Комментарий: ________________________________              │
│                                                             │
│  [Отправить заявку]                                        │
└─────────────────────────────────────────────────────────────┘
```

---

## Ключевые отличия от старой системы

### Старая система ❌
```
Учебная группа
    └─→ Настройки анонса (внутри группы)
        └─→ Заявки привязаны к группе
            └─→ Представитель подаёт заявку на группу
```

### Новая система ✅
```
Объявление (отдельная сущность)
    └─→ Несколько учебных групп
        └─→ Заявки привязаны к объявлению
            └─→ Представитель подаёт заявку на объявление
                └─→ Выбирает группы внутри объявления
```

---

## Преимущества новой архитектуры

1. **Гибкость**: Одно объявление → много групп
2. **Централизация**: Все заявки в одном месте
3. **Масштабируемость**: Легко добавлять новые типы
4. **Разделение**: Группы = обучение, Объявления = набор
5. **UX**: Представители видят все возможности в одном месте
