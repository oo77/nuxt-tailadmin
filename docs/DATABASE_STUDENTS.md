# База данных студентов

## Описание

Реализован полнофункциональный модуль управления студентами с возможностью добавления, редактирования, удаления студентов и управления их сертификатами.

## Структура данных

### Студент (Student)

- **id** (string) - Уникальный идентификатор
- **fullName** (string) - Ф.И.О (обязательно)
- **pinfl** (string) - ПИНФЛ, 14 цифр (обязательно, уникальный)
- **organization** (string) - Организация (обязательно)
- **department** (string | null) - Служба/отдел (необязательно)
- **position** (string) - Должность (обязательно)
- **certificates** (StudentCertificate[]) - Массив сертификатов
- **created_at** (Date) - Дата создания
- **updated_at** (Date) - Дата обновления

### Сертификат (StudentCertificate)

- **id** (string) - Уникальный идентификатор
- **studentId** (string) - ID студента
- **courseName** (string) - Название курса
- **issueDate** (Date) - Дата получения
- **certificateNumber** (string) - Номер сертификата
- **fileUrl** (string | null) - Ссылка на файл сертификата (необязательно)
- **expiryDate** (Date | null) - Срок годности (необязательно)
- **created_at** (Date) - Дата создания
- **updated_at** (Date) - Дата обновления

## API Endpoints

### Студенты

#### GET /api/students

Получить список всех студентов

**Требуется авторизация:** Да (ADMIN, MANAGER, TEACHER)

**Ответ:**

```json
{
  "success": true,
  "students": Student[],
  "total": number
}
```

#### POST /api/students

Создать нового студента

**Требуется авторизация:** Да (ADMIN, MANAGER, TEACHER)

**Тело запроса:**

```json
{
  "fullName": "string",
  "pinfl": "string (14 цифр)",
  "organization": "string",
  "department": "string (optional)",
  "position": "string"
}
```

**Валидация:**

- Все обязательные поля должны быть заполнены
- ПИНФЛ должен содержать ровно 14 цифр
- ПИНФЛ должен быть уникальным

#### GET /api/students/:id

Получить студента по ID

**Требуется авторизация:** Да (ADMIN, MANAGER, TEACHER)

#### PUT /api/students/:id

Обновить данные студента

**Требуется авторизация:** Да (ADMIN, MANAGER, TEACHER)

**Тело запроса:** Частичное обновление (любые поля из CreateStudentInput)

#### DELETE /api/students/:id

Удалить студента

**Требуется авторизация:** Да (ADMIN, MANAGER, TEACHER)

### Сертификаты

#### POST /api/students/:id/certificates

Добавить сертификат студенту

**Требуется авторизация:** Да (ADMIN, MANAGER, TEACHER)

**Тело запроса:**

```json
{
  "courseName": "string",
  "certificateNumber": "string",
  "issueDate": "Date | string",
  "fileUrl": "string (optional)",
  "expiryDate": "Date | string (optional)"
}
```

**Валидация:**

- Все обязательные поля должны быть заполнены
- Дата получения должна быть корректной
- Срок годности (если указан) должен быть позже даты получения

#### DELETE /api/certificates/:id

Удалить сертификат

**Требуется авторизация:** Да (ADMIN, MANAGER, TEACHER)

## Авторизация

### Использование API

Все API endpoints для студентов защищены авторизацией. Для работы с ними необходимо:

1. **Войти в систему** через `/auth/signin`
2. **Использовать `useAuthFetch`** composable в компонентах:

```typescript
const { authFetch } = useAuthFetch();

const response = await authFetch("/api/students", {
  method: "GET",
});
```

### Доступные роли

- **ADMIN** - полный доступ ко всем функциям
- **MANAGER** - полный доступ к управлению студентами
- **TEACHER** - полный доступ к управлению студентами
- **STUDENT** - НЕТ доступа к управлению студентами

### Токены

- **Access Token:** хранится в cookie `auth_token`, срок жизни 7 дней
- **Refresh Token:** хранится в cookie `auth_refresh_token`, срок жизни 30 дней
- Автоматическое обновление токена при истечении

Подробнее см. `docs/AUTH_FIX.md`

## Компоненты

### Страницы

- **`/database`** - Главная страница "База данных" с вкладками

### Компоненты

- **`DatabaseStudentManagementPanel`** - Основной компонент управления студентами
- **`DatabaseStudentTable`** - Таблица со списком студентов
- **`DatabaseStudentFormModal`** - Модальное окно для создания/редактирования студента
- **`DatabaseStudentCertificatesModal`** - Модальное окно для просмотра и управления сертификатами
- **`DatabaseCertificateFormModal`** - Модальное окно для добавления сертификата

### UI компоненты

- **`UiModal`** - Универсальное модальное окно
- **`UiButton`** - Кнопка с вариантами: primary, secondary, success, danger, warning, outline

## Навигация

Новый пункт меню "База данных" добавлен в сайдбар с иконкой базы данных.

## Хранилище данных

В текущей реализации используется временное хранилище в памяти (`server/utils/studentStorage.ts`).

**Тестовые данные:**

- 2 студента с различными данными
- У первого студента 2 сертификата
- У второго студента нет сертификатов

### Миграция на базу данных

Для перехода на реальную базу данных необходимо:

1. Создать таблицы в БД:

   - `students` - таблица студентов
   - `certificates` - таблица сертификатов

2. Заменить функции в `studentStorage.ts` на запросы к БД

3. Настроить ORM (например, Prisma, Drizzle или TypeORM)

## Функциональность

### Управление студентами

- ✅ Просмотр списка студентов
- ✅ Добавление нового студента
- ✅ Редактирование данных студента
- ✅ Удаление студента
- ✅ Валидация всех полей
- ✅ Проверка уникальности ПИНФЛ

### Управление сертификатами

- ✅ Просмотр списка сертификатов студента
- ✅ Добавление нового сертификата
- ✅ Удаление сертификата
- ✅ Отображение истекших сертификатов
- ✅ Ссылка на файл сертификата
- ✅ Валидация дат

## Будущие улучшения

- [ ] Поиск и фильтрация студентов
- [ ] Пагинация списка студентов
- [ ] Экспорт данных в Excel/PDF
- [ ] Загрузка файлов сертификатов
- [ ] Уведомления об истекающих сертификатах
- [ ] История изменений
- [ ] Массовые операции
- [ ] Интеграция с реальной базой данных
- [ ] Права доступа для разных ролей
