# Быстрый старт: Импорт студентов

## Что реализовано

✅ Загрузка Excel файлов (до 9000+ строк)  
✅ Drag & drop интерфейс  
✅ Предварительный просмотр данных  
✅ Анализ перед импортом (новые/обновления)  
✅ Batch-обработка для производительности  
✅ Real-time прогресс-бар  
✅ Автоматическое создание/обновление по ПИНФЛ  
✅ Детальный отчёт об ошибках  
✅ Скачивание CSV отчёта  
✅ Красивые анимации и UI

## Как использовать

### 1. Подготовка Excel файла

Создайте Excel файл со следующими заголовками в первой строке:

| ПИНФЛ | ФИО | Организация | Служба/Отдел | Должность |
| ----- | --- | ----------- | ------------ | --------- |

**Требования:**

- ПИНФЛ: ровно 14 цифр
- ФИО: минимум 3 символа
- Организация: обязательно
- Должность: обязательно
- Служба/Отдел: опционально

### 2. Импорт

1. Откройте страницу "База данных"
2. Нажмите кнопку **"Импорт студентов"** (рядом с "Добавить студента")
3. Загрузите файл (перетащите или выберите)
4. Просмотрите анализ:
   - Сколько записей будет создано
   - Сколько будет обновлено
   - Какие ошибки найдены
5. Нажмите **"Импортировать"**
6. Дождитесь завершения
7. Просмотрите результаты

### 3. Логика обновления

- **Если ПИНФЛ существует** → обновляются все поля (ФИО, Организация, Отдел, Должность)
- **Если ПИНФЛ новый** → создаётся новый студент

## Структура проекта

```
app/
├── pages/database/import.vue              # Страница импорта
├── components/database/
│   ├── ImportUploader.vue                 # Загрузка файла
│   ├── ImportAnalysis.vue                 # Анализ
│   ├── ImportProgress.vue                 # Прогресс
│   └── ImportResults.vue                  # Результаты
└── types/import.ts                        # Типы

server/
├── api/students/import/
│   ├── analyze.post.ts                    # POST /api/students/import/analyze
│   ├── execute.post.ts                    # POST /api/students/import/execute
│   └── status/[jobId].get.ts             # GET /api/students/import/status/:jobId
└── utils/importUtils.ts                   # Логика импорта
```

## API Endpoints

### Анализ файла

```http
POST /api/students/import/analyze
Content-Type: multipart/form-data

{
  file: <Excel файл>
}
```

**Ответ:**

```json
{
  "success": true,
  "analysis": {
    "totalRows": 9000,
    "validRows": 8950,
    "invalidRows": 50,
    "newStudents": 8000,
    "existingStudents": 950,
    "errors": [...],
    "preview": [...]
  }
}
```

### Запуск импорта

```http
POST /api/students/import/execute
Content-Type: multipart/form-data

{
  file: <Excel файл>
}
```

**Ответ:**

```json
{
  "success": true,
  "jobId": "import_1234567890_abc123",
  "message": "Импорт запущен"
}
```

### Статус импорта

```http
GET /api/students/import/status/:jobId
```

**Ответ:**

```json
{
  "success": true,
  "status": {
    "jobId": "import_1234567890_abc123",
    "status": "processing",
    "totalRows": 8950,
    "processedRows": 4500,
    "successCount": 4480,
    "errorCount": 20,
    "createdCount": 4000,
    "updatedCount": 480,
    "errors": [...]
  }
}
```

## Производительность

- **9000 строк**: ~5-10 секунд
- **Batch размер**: 100 записей
- **Polling**: каждые 500ms
- **Задержка между батчами**: 50ms

## Обработка ошибок

Ошибки отображаются на каждом этапе:

1. **При загрузке**: неверный формат файла
2. **При анализе**: ошибки валидации данных
3. **При импорте**: ошибки создания/обновления
4. **После импорта**: полный отчёт с возможностью скачивания

## Пример Excel файла

```
ПИНФЛ              ФИО                      Организация      Служба/Отдел  Должность
12345678901234     Иванов Иван Иванович     ООО "Пример"     IT отдел      Разработчик
98765432109876     Петрова Мария Сергеевна  АО "Технологии"  HR отдел      Менеджер
11223344556677     Сидоров Петр Петрович    ЗАО "Инновации"               Директор
```

## Зависимости

```json
{
  "xlsx": "^0.18.5"
}
```

Установка:

```bash
npm install xlsx
```

## Дополнительная документация

Подробная документация: [docs/IMPORT_FEATURE.md](./IMPORT_FEATURE.md)
